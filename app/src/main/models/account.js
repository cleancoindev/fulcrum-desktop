'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _minidb = require('minidb');

var _project = require('./project');

var _project2 = _interopRequireDefault(_project);

var _choiceList = require('./choice-list');

var _choiceList2 = _interopRequireDefault(_choiceList);

var _classificationSet = require('./classification-set');

var _classificationSet2 = _interopRequireDefault(_classificationSet);

var _form = require('./form');

var _form2 = _interopRequireDefault(_form);

var _record = require('./record');

var _record2 = _interopRequireDefault(_record);

var _role = require('./role');

var _role2 = _interopRequireDefault(_role);

var _membership = require('./membership');

var _membership2 = _interopRequireDefault(_membership);

var _syncState = require('./sync-state');

var _syncState2 = _interopRequireDefault(_syncState);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Account {
  static get tableName() {
    return 'accounts';
  }

  static get columns() {
    return [{ name: 'userResourceID', column: 'user_resource_id', type: 'string', null: false }, { name: 'organizationResourceID', column: 'organization_resource_id', type: 'string', null: false }, { name: 'organizationName', column: 'organization_name', type: 'string', null: false }, { name: 'email', column: 'email', type: 'string', null: false }, { name: 'firstName', column: 'first_name', type: 'string' }, { name: 'lastName', column: 'last_name', type: 'string' }, { name: 'lastSyncPhotos', column: 'last_sync_photos', type: 'datetime' }, { name: 'lastSyncVideos', column: 'last_sync_videos', type: 'datetime' }, { name: 'lastSyncAudio', column: 'last_sync_audio', type: 'datetime' }, { name: 'lastSyncSignatures', column: 'last_sync_signatures', type: 'datetime' }, { name: 'lastSyncChangesets', column: 'last_sync_changesets', type: 'datetime' }, { name: 'token', column: 'token', type: 'string' }];
  }

  get userResourceID() {
    return this._userResourceID;
  }

  get organizationResourceID() {
    return this._organizationResourceID;
  }

  get organizationName() {
    return this._organizationName;
  }

  get email() {
    return this._email;
  }

  get firstName() {
    return this._firstName;
  }

  get lastName() {
    return this._lastName;
  }

  get token() {
    return this._token;
  }

  static findByUserAndOrganization(userID, organizationID, callback) {
    return Account.findFirst({ user_resource_id: userID,
      organization_resource_id: organizationID }, callback);
  }

  findForms(where) {
    return _form2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findProjects(where) {
    return _project2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findChoiceLists(where) {
    return _choiceList2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findClassificationSets(where) {
    return _classificationSet2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findRoles(where) {
    return _role2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findMemberships(where) {
    return _membership2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID }), 'email ASC');
  }

  findFirstForm(where) {
    return _form2.default.findFirst(this.db, _extends({}, where, { account_id: this.rowID }), 'name ASC');
  }

  findFirstRecord(where) {
    return _record2.default.findFirst(this.db, _extends({}, where, { account_id: this.rowID }));
  }

  findEachRecord(where, callback) {
    return _record2.default.findEach(this.db, { where: _extends({}, where, { account_id: this.rowID }) }, callback);
  }

  findEachBySQL(sql, values, callback) {
    return this.db.each(sql, values, callback);
  }

  findBySQL(sql, values, callback) {
    return this.db.all(sql, values, callback);
  }

  findActiveForms(where) {
    return _form2.default.findAll(this.db, _extends({}, where, { account_id: this.rowID, deleted_at: null }), 'name ASC');
  }

  projectByResourceID(projectId) {
    return _project2.default.findFirst(this.db, { account_id: this.rowID });
  }

  findSyncState(where) {
    return _syncState2.default.findOrCreate(this.db, _extends({}, where, { account_id: this.rowID }));
  }
}

exports.default = Account;
_minidb.PersistentObject.register(Account);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tYWluL21vZGVscy9hY2NvdW50LmpzIl0sIm5hbWVzIjpbIkFjY291bnQiLCJ0YWJsZU5hbWUiLCJjb2x1bW5zIiwibmFtZSIsImNvbHVtbiIsInR5cGUiLCJudWxsIiwidXNlclJlc291cmNlSUQiLCJfdXNlclJlc291cmNlSUQiLCJvcmdhbml6YXRpb25SZXNvdXJjZUlEIiwiX29yZ2FuaXphdGlvblJlc291cmNlSUQiLCJvcmdhbml6YXRpb25OYW1lIiwiX29yZ2FuaXphdGlvbk5hbWUiLCJlbWFpbCIsIl9lbWFpbCIsImZpcnN0TmFtZSIsIl9maXJzdE5hbWUiLCJsYXN0TmFtZSIsIl9sYXN0TmFtZSIsInRva2VuIiwiX3Rva2VuIiwiZmluZEJ5VXNlckFuZE9yZ2FuaXphdGlvbiIsInVzZXJJRCIsIm9yZ2FuaXphdGlvbklEIiwiY2FsbGJhY2siLCJmaW5kRmlyc3QiLCJ1c2VyX3Jlc291cmNlX2lkIiwib3JnYW5pemF0aW9uX3Jlc291cmNlX2lkIiwiZmluZEZvcm1zIiwid2hlcmUiLCJmaW5kQWxsIiwiZGIiLCJhY2NvdW50X2lkIiwicm93SUQiLCJmaW5kUHJvamVjdHMiLCJmaW5kQ2hvaWNlTGlzdHMiLCJmaW5kQ2xhc3NpZmljYXRpb25TZXRzIiwiZmluZFJvbGVzIiwiZmluZE1lbWJlcnNoaXBzIiwiZmluZEZpcnN0Rm9ybSIsImZpbmRGaXJzdFJlY29yZCIsImZpbmRFYWNoUmVjb3JkIiwiZmluZEVhY2giLCJmaW5kRWFjaEJ5U1FMIiwic3FsIiwidmFsdWVzIiwiZWFjaCIsImZpbmRCeVNRTCIsImFsbCIsImZpbmRBY3RpdmVGb3JtcyIsImRlbGV0ZWRfYXQiLCJwcm9qZWN0QnlSZXNvdXJjZUlEIiwicHJvamVjdElkIiwiZmluZFN5bmNTdGF0ZSIsImZpbmRPckNyZWF0ZSIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7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QUwsQ0FBUWUsSUFBUixDQUFhRixHQUFiLEVBQWtCQyxNQUFsQixFQUEwQnJCLFFBQTFCLENBQVA7QUFDRDs7QUFFRHVCLFlBQVVILEdBQVYsRUFBZUMsTUFBZixFQUF1QnJCLFFBQXZCLEVBQWlDO0FBQy9CLFdBQU8sS0FBS08sRUFBTCxDQUFRaUIsR0FBUixDQUFZSixHQUFaLEVBQWlCQyxNQUFqQixFQUF5QnJCLFFBQXpCLENBQVA7QUFDRDs7QUFFRHlCLGtCQUFnQnBCLEtBQWhCLEVBQXVCO0FBQ3JCLFdBQU8sZUFBS0MsT0FBTCxDQUFhLEtBQUtDLEVBQWxCLGVBQTBCRixLQUExQixJQUFpQ0csWUFBWSxLQUFLQyxLQUFsRCxFQUF5RGlCLFlBQVksSUFBckUsS0FBNEUsVUFBNUUsQ0FBUDtBQUNEOztBQUVEQyxzQkFBb0JDLFNBQXBCLEVBQStCO0FBQzdCLFdBQU8sa0JBQVEzQixTQUFSLENBQWtCLEtBQUtNLEVBQXZCLEVBQTJCLEVBQUNDLFlBQVksS0FBS0MsS0FBbEIsRUFBM0IsQ0FBUDtBQUNEOztBQUVEb0IsZ0JBQWN4QixLQUFkLEVBQXFCO0FBQ25CLFdBQU8sb0JBQVV5QixZQUFWLENBQXVCLEtBQUt2QixFQUE1QixlQUFvQ0YsS0FBcEMsSUFBMkNHLFlBQVksS0FBS0MsS0FBNUQsSUFBUDtBQUNEO0FBN0cwQjs7a0JBQVJqQyxPO0FBZ0hyQix5QkFBaUJ1RCxRQUFqQixDQUEwQnZELE9BQTFCIiwiZmlsZSI6ImFjY291bnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQZXJzaXN0ZW50T2JqZWN0IH0gZnJvbSAnbWluaWRiJztcbmltcG9ydCBQcm9qZWN0IGZyb20gJy4vcHJvamVjdCc7XG5pbXBvcnQgQ2hvaWNlTGlzdCBmcm9tICcuL2Nob2ljZS1saXN0JztcbmltcG9ydCBDbGFzc2lmaWNhdGlvblNldCBmcm9tICcuL2NsYXNzaWZpY2F0aW9uLXNldCc7XG5pbXBvcnQgRm9ybSBmcm9tICcuL2Zvcm0nO1xuaW1wb3J0IFJlY29yZCBmcm9tICcuL3JlY29yZCc7XG5pbXBvcnQgUm9sZSBmcm9tICcuL3JvbGUnO1xuaW1wb3J0IE1lbWJlcnNoaXAgZnJvbSAnLi9tZW1iZXJzaGlwJztcbmltcG9ydCBTeW5jU3RhdGUgZnJvbSAnLi9zeW5jLXN0YXRlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWNjb3VudCB7XG4gIHN0YXRpYyBnZXQgdGFibGVOYW1lKCkge1xuICAgIHJldHVybiAnYWNjb3VudHMnO1xuICB9XG5cbiAgc3RhdGljIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiBbXG4gICAgICB7IG5hbWU6ICd1c2VyUmVzb3VyY2VJRCcsIGNvbHVtbjogJ3VzZXJfcmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ29yZ2FuaXphdGlvblJlc291cmNlSUQnLCBjb2x1bW46ICdvcmdhbml6YXRpb25fcmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ29yZ2FuaXphdGlvbk5hbWUnLCBjb2x1bW46ICdvcmdhbml6YXRpb25fbmFtZScsIHR5cGU6ICdzdHJpbmcnLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAnZW1haWwnLCBjb2x1bW46ICdlbWFpbCcsIHR5cGU6ICdzdHJpbmcnLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAnZmlyc3ROYW1lJywgY29sdW1uOiAnZmlyc3RfbmFtZScsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0TmFtZScsIGNvbHVtbjogJ2xhc3RfbmFtZScsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luY1Bob3RvcycsIGNvbHVtbjogJ2xhc3Rfc3luY19waG90b3MnLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luY1ZpZGVvcycsIGNvbHVtbjogJ2xhc3Rfc3luY192aWRlb3MnLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luY0F1ZGlvJywgY29sdW1uOiAnbGFzdF9zeW5jX2F1ZGlvJywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAnbGFzdFN5bmNTaWduYXR1cmVzJywgY29sdW1uOiAnbGFzdF9zeW5jX3NpZ25hdHVyZXMnLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luY0NoYW5nZXNldHMnLCBjb2x1bW46ICdsYXN0X3N5bmNfY2hhbmdlc2V0cycsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ3Rva2VuJywgY29sdW1uOiAndG9rZW4nLCB0eXBlOiAnc3RyaW5nJyB9XG4gICAgXTtcbiAgfVxuXG4gIGdldCB1c2VyUmVzb3VyY2VJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5fdXNlclJlc291cmNlSUQ7XG4gIH1cblxuICBnZXQgb3JnYW5pemF0aW9uUmVzb3VyY2VJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5fb3JnYW5pemF0aW9uUmVzb3VyY2VJRDtcbiAgfVxuXG4gIGdldCBvcmdhbml6YXRpb25OYW1lKCkge1xuICAgIHJldHVybiB0aGlzLl9vcmdhbml6YXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0IGVtYWlsKCkge1xuICAgIHJldHVybiB0aGlzLl9lbWFpbDtcbiAgfVxuXG4gIGdldCBmaXJzdE5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpcnN0TmFtZTtcbiAgfVxuXG4gIGdldCBsYXN0TmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGFzdE5hbWU7XG4gIH1cblxuICBnZXQgdG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Rva2VuO1xuICB9XG5cbiAgc3RhdGljIGZpbmRCeVVzZXJBbmRPcmdhbml6YXRpb24odXNlcklELCBvcmdhbml6YXRpb25JRCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gQWNjb3VudC5maW5kRmlyc3Qoe3VzZXJfcmVzb3VyY2VfaWQ6IHVzZXJJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbl9yZXNvdXJjZV9pZDogb3JnYW5pemF0aW9uSUR9LCBjYWxsYmFjayk7XG4gIH1cblxuICBmaW5kRm9ybXMod2hlcmUpIHtcbiAgICByZXR1cm4gRm9ybS5maW5kQWxsKHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZFByb2plY3RzKHdoZXJlKSB7XG4gICAgcmV0dXJuIFByb2plY3QuZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9LCAnbmFtZSBBU0MnKTtcbiAgfVxuXG4gIGZpbmRDaG9pY2VMaXN0cyh3aGVyZSkge1xuICAgIHJldHVybiBDaG9pY2VMaXN0LmZpbmRBbGwodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSwgJ25hbWUgQVNDJyk7XG4gIH1cblxuICBmaW5kQ2xhc3NpZmljYXRpb25TZXRzKHdoZXJlKSB7XG4gICAgcmV0dXJuIENsYXNzaWZpY2F0aW9uU2V0LmZpbmRBbGwodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSwgJ25hbWUgQVNDJyk7XG4gIH1cblxuICBmaW5kUm9sZXMod2hlcmUpIHtcbiAgICByZXR1cm4gUm9sZS5maW5kQWxsKHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZE1lbWJlcnNoaXBzKHdoZXJlKSB7XG4gICAgcmV0dXJuIE1lbWJlcnNoaXAuZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9LCAnZW1haWwgQVNDJyk7XG4gIH1cblxuICBmaW5kRmlyc3RGb3JtKHdoZXJlKSB7XG4gICAgcmV0dXJuIEZvcm0uZmluZEZpcnN0KHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZEZpcnN0UmVjb3JkKHdoZXJlKSB7XG4gICAgcmV0dXJuIFJlY29yZC5maW5kRmlyc3QodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cblxuICBmaW5kRWFjaFJlY29yZCh3aGVyZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gUmVjb3JkLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoQnlTUUwoc3FsLCB2YWx1ZXMsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuZWFjaChzcWwsIHZhbHVlcywgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEJ5U1FMKHNxbCwgdmFsdWVzLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB0aGlzLmRiLmFsbChzcWwsIHZhbHVlcywgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEFjdGl2ZUZvcm1zKHdoZXJlKSB7XG4gICAgcmV0dXJuIEZvcm0uZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUQsIGRlbGV0ZWRfYXQ6IG51bGx9LCAnbmFtZSBBU0MnKTtcbiAgfVxuXG4gIHByb2plY3RCeVJlc291cmNlSUQocHJvamVjdElkKSB7XG4gICAgcmV0dXJuIFByb2plY3QuZmluZEZpcnN0KHRoaXMuZGIsIHthY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cblxuICBmaW5kU3luY1N0YXRlKHdoZXJlKSB7XG4gICAgcmV0dXJuIFN5bmNTdGF0ZS5maW5kT3JDcmVhdGUodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cbn1cblxuUGVyc2lzdGVudE9iamVjdC5yZWdpc3RlcihBY2NvdW50KTtcbiJdfQ==