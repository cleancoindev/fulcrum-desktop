{"version":3,"sources":["../../../src/main/db/migration.js"],"names":["MIGRATIONS","Migration","constructor","db","versionName","executeMigrationSQL","suffix","data","sql","part","split","trim","length","substring","push","results","script","verbose","console","log","execute","executeUpgradeSQL","executeDowngradeSQL","up","down"],"mappings":";;;;;;AAAA;;;;;;;;AAEA,MAAMA,aAAa;AACjB;AADiB,CAAnB;;AAIe,MAAMC,SAAN,CAAgB;AAC7BC,cAAYC,EAAZ,EAAgBC,WAAhB,EAA6B;AAC3B,SAAKD,EAAL,GAAUA,EAAV;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACD;;AAEKC,qBAAN,CAA0BC,MAA1B,EAAkC;AAAA;;AAAA;AAChC,YAAMC,OAAOP,WAAW,MAAKI,WAAhB,CAAb;;AAEA,YAAMI,MAAM,EAAZ;;AAEA,WAAK,IAAIC,IAAT,IAAiBF,KAAKG,KAAL,CAAW,MAAX,CAAjB,EAAqC;AACnC,YAAID,KAAKE,IAAL,GAAYC,MAAZ,IAAsBH,KAAKE,IAAL,GAAYE,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,IAA1D,EAAgE;AAC9DL,cAAIM,IAAJ,CAASL,KAAKE,IAAL,EAAT;AACD;AACF;;AAED,UAAIH,IAAII,MAAJ,KAAe,CAAnB,EAAsB;AACpB,eAAO,EAAP;AACD;;AAED,YAAMG,UAAU,EAAhB;;AAEA,WAAK,IAAIC,MAAT,IAAmBR,GAAnB,EAAwB;AACtB,YAAI,MAAKL,EAAL,CAAQc,OAAZ,EAAqB;AACnBC,kBAAQC,GAAR,CAAYH,MAAZ,EAAoB,IAApB;AACD;;AAEDD,gBAAQD,IAAR,EAAa,MAAM,MAAKX,EAAL,CAAQiB,OAAR,CAAgBJ,MAAhB,CAAnB;AACD;;AAED,aAAOD,OAAP;AAzBgC;AA0BjC;;AAEKM,mBAAN,GAA0B;AAAA;;AAAA;AACxB,aAAO,MAAM,OAAKhB,mBAAL,CAAyB,IAAzB,CAAb;AADwB;AAEzB;;AAEKiB,qBAAN,GAA4B;AAAA;;AAAA;AAC1B,aAAO,MAAM,OAAKjB,mBAAL,CAAyB,MAAzB,CAAb;AAD0B;AAE3B;;AAEKkB,IAAN,GAAW;AAAA;;AAAA;AACT,aAAO,MAAM,OAAKF,iBAAL,EAAb;AADS;AAEV;;AAEKG,MAAN,GAAa;AAAA;;AAAA;AACX,aAAO,MAAM,OAAKF,mBAAL,EAAb;AADW;AAEZ;AAhD4B;kBAAVrB,S","file":"migration.js","sourcesContent":["import V1 from './migrations/version_001';\n\nconst MIGRATIONS = {\n  '001': V1\n};\n\nexport default class Migration {\n  constructor(db, versionName) {\n    this.db = db;\n    this.versionName = versionName;\n  }\n\n  async executeMigrationSQL(suffix) {\n    const data = MIGRATIONS[this.versionName];\n\n    const sql = [];\n\n    for (let part of data.split('\\n\\n')) {\n      if (part.trim().length && part.trim().substring(0, 2) !== '--') {\n        sql.push(part.trim());\n      }\n    }\n\n    if (sql.length === 0) {\n      return [];\n    }\n\n    const results = [];\n\n    for (let script of sql) {\n      if (this.db.verbose) {\n        console.log(script, '\\n');\n      }\n\n      results.push(await this.db.execute(script));\n    }\n\n    return results;\n  }\n\n  async executeUpgradeSQL() {\n    return await this.executeMigrationSQL('up');\n  }\n\n  async executeDowngradeSQL() {\n    return await this.executeMigrationSQL('down');\n  }\n\n  async up() {\n    return await this.executeUpgradeSQL();\n  }\n\n  async down() {\n    return await this.executeDowngradeSQL();\n  }\n}\n"]}