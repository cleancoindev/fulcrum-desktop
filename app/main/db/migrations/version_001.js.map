{"version":3,"sources":["../../../../src/main/db/migrations/version_001.js"],"names":[],"mappings":";;;;;kBAAgB","file":"version_001.js","sourcesContent":["export default `\nCREATE TABLE IF NOT EXISTS accounts (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  user_resource_id TEXT,\n  organization_resource_id TEXT,\n  organization_name TEXT,\n  email TEXT,\n  first_name TEXT,\n  last_name TEXT,\n  description TEXT,\n  token TEXT,\n  last_sync_photos INTEGER,\n  last_sync_videos INTEGER,\n  last_sync_audio INTEGER,\n  last_sync_signatures INTEGER,\n  last_sync_changesets INTEGER,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_accounts_user_organization ON accounts (user_resource_id ASC, organization_resource_id ASC);\n\nCREATE TABLE IF NOT EXISTS sync_state (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource TEXT NOT NULL,\n  scope TEXT,\n  hash TEXT,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_sync_state_account_resource_scope ON sync_state (account_id ASC, resource ASC, scope ASC);\n\nCREATE TABLE IF NOT EXISTS records (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  form_id INTEGER NOT NULL,\n  status TEXT,\n  version INTEGER NOT NULL,\n  title TEXT,\n  form_values TEXT,\n  latitude REAL,\n  longitude REAL,\n  altitude REAL,\n  course REAL,\n  speed REAL,\n  horizontal_accuracy REAL,\n  vertical_accuracy REAL,\n  client_created_at INTEGER,\n  client_updated_at INTEGER,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  changeset_id INTEGER,\n  changeset_resource_id TEXT,\n  project_id INTEGER,\n  project_resource_id TEXT,\n  assigned_to_id INTEGER,\n  assigned_to_resource_id TEXT,\n  updated_by_id INTEGER,\n  updated_by_resource_id TEXT,\n  created_by_id INTEGER,\n  created_by_resource_id TEXT,\n  draft INTEGER NOT NULL DEFAULT 0,\n  has_changes INTEGER NOT NULL DEFAULT 0,\n  is_new INTEGER NOT NULL DEFAULT 0,\n  last_error TEXT,\n  index_text TEXT,\n  created_latitude REAL,\n  created_longitude REAL,\n  created_altitude REAL,\n  created_accuracy REAL,\n  updated_latitude REAL,\n  updated_longitude REAL,\n  updated_altitude REAL,\n  updated_accuracy REAL,\n  created_duration INTEGER,\n  updated_duration INTEGER,\n  edited_duration INTEGER\n);\n\nCREATE UNIQUE INDEX idx_records_account_resource_id ON records (account_id, resource_id);\n\nCREATE VIRTUAL TABLE records_index USING fts4(content='records', index_text, form_id, prefix=\"1,2,3\");\n\nCREATE TRIGGER records_before_update BEFORE UPDATE ON records BEGIN\n  DELETE FROM records_index WHERE docid=old.rowid;\nEND;\n\nCREATE TRIGGER records_before_delete BEFORE DELETE ON records BEGIN\n  DELETE FROM records_index WHERE docid=old.rowid;\nEND;\n\nCREATE TRIGGER records_after_update AFTER UPDATE ON records BEGIN\n  INSERT INTO records_index (docid, index_text, form_id) VALUES (new.rowid, new.index_text, new.form_id);\nEND;\n\nCREATE TRIGGER records_after_insert AFTER INSERT ON records BEGIN\n  INSERT INTO records_index (docid, index_text, form_id) VALUES (new.rowid, new.index_text, new.form_id);\nEND;\n\nCREATE INDEX IF NOT EXISTS idx_records_account_id ON records (account_id);\nCREATE INDEX IF NOT EXISTS idx_records_account_id_remote_id ON records (account_id, resource_id);\nCREATE INDEX IF NOT EXISTS idx_records_form_status ON records (form_id, status);\nCREATE INDEX IF NOT EXISTS idx_records_form_title ON records (form_id, title);\nCREATE INDEX IF NOT EXISTS idx_records_form_client_created_at ON records (form_id, client_created_at);\nCREATE INDEX IF NOT EXISTS idx_records_form_client_updated_at ON records (form_id, client_updated_at);\nCREATE INDEX IF NOT EXISTS idx_records_form_resource_id ON records (form_id, resource_id);\nCREATE INDEX IF NOT EXISTS idx_records_form_latitude_longitude ON records (form_id, latitude, longitude);\nCREATE INDEX IF NOT EXISTS idx_records_form_project ON records (form_id, project_id);\nCREATE INDEX IF NOT EXISTS idx_records_latitude_longitude ON records (latitude, longitude);\n\nCREATE TABLE IF NOT EXISTS roles (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  name TEXT,\n  is_system INTEGER NOT NULL,\n  is_default INTEGER NOT NULL,\n  can_manage_subscription INTEGER NOT NULL,\n  can_update_organization INTEGER NOT NULL,\n  can_manage_members INTEGER NOT NULL,\n  can_manage_roles INTEGER NOT NULL,\n  can_manage_layers INTEGER NOT NULL,\n  can_manage_apps INTEGER NOT NULL,\n  can_create_records INTEGER NOT NULL,\n  can_update_records INTEGER NOT NULL,\n  can_delete_records INTEGER NOT NULL,\n  can_manage_projects INTEGER NOT NULL,\n  can_manage_choice_lists INTEGER NOT NULL,\n  can_manage_classification_sets INTEGER NOT NULL,\n  can_change_status INTEGER NOT NULL,\n  can_change_project INTEGER NOT NULL,\n  can_assign_records INTEGER NOT NULL,\n  can_import_records INTEGER NOT NULL,\n  can_export_records INTEGER NOT NULL,\n  can_run_reports INTEGER NOT NULL,\n  can_manage_authorizations INTEGER NOT NULL,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_roles_account_resource_id ON roles (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS memberships (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  user_resource_id TEXT NOT NULL,\n  first_name TEXT,\n  last_name TEXT,\n  email TEXT NOT NULL,\n  role_id INTEGER NOT NULL,\n  role_resource_id TEXT NOT NULL,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_memberships_account_user_organization ON memberships (account_id, user_resource_id);\n\nCREATE TABLE IF NOT EXISTS choice_lists (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  choices TEXT,\n  name TEXT,\n  description TEXT,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_choice_lists_account_resource_id ON choice_lists (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS classification_sets (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  items TEXT,\n  name TEXT,\n  description TEXT,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_classification_sets_account_resource_id ON classification_sets (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS projects (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  name TEXT,\n  description TEXT,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_projects_account_resource_id ON projects (account_id, resource_id);\nCREATE INDEX IF NOT EXISTS idx_projects_account_id_name ON projects (account_id, name);\n\nCREATE TABLE IF NOT EXISTS forms (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  version INTEGER NOT NULL,\n  name TEXT,\n  description TEXT,\n  title_field_keys TEXT,\n  status_field TEXT,\n  elements TEXT,\n  last_sync INTEGER,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL,\n  deleted_at INTEGER\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_forms_account_resource_id ON forms (account_id, resource_id);\nCREATE INDEX IF NOT EXISTS idx_forms_account_id ON forms (account_id);\nCREATE INDEX IF NOT EXISTS idx_forms_account_id_name ON forms (account_id, name);\n\nCREATE TABLE IF NOT EXISTS photos (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  file_path TEXT,\n  exif TEXT,\n  form_id INTEGER,\n  record_id INTEGER,\n  latitude REAL,\n  longitude REAL,\n  is_downloaded INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_photos_account_resource_id ON photos (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS videos (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  file_path TEXT,\n  metadata TEXT,\n  form_id INTEGER,\n  record_id INTEGER,\n  is_downloaded INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_videos_account_resource_id ON videos (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS audio (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  file_path TEXT,\n  metadata TEXT,\n  form_id INTEGER,\n  record_id INTEGER,\n  is_downloaded INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_audio_account_resource_id ON audio (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS signatures (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  file_path TEXT,\n  form_id INTEGER,\n  record_id INTEGER,\n  is_downloaded INTEGER NOT NULL DEFAULT 0,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_signatures_account_resource_id ON signatures (account_id, resource_id);\n\nCREATE TABLE IF NOT EXISTS changesets (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  account_id INTEGER NOT NULL,\n  resource_id TEXT NOT NULL,\n  form_id INTEGER,\n  metadata TEXT,\n  metadata_index_text TEXT,\n  closed_at INTEGER,\n  closed_by_id INTEGER,\n  closed_by_resource_id TEXT,\n  created_by_id INTEGER,\n  created_by_resource_id TEXT,\n  number_of_changes INTEGER NOT NULL DEFAULT 0,\n  min_lat REAL,\n  max_lat REAL,\n  min_lon REAL,\n  max_lon REAL,\n  created_at INTEGER NOT NULL,\n  updated_at INTEGER NOT NULL\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_changesets_account_resource_id ON changesets (account_id, resource_id);\n\nCREATE VIRTUAL TABLE changesets_index USING fts4(content='changesets', metadata_index_text, form_id, prefix=\"1,2,3\");\n\nCREATE TRIGGER changesets_before_update BEFORE UPDATE ON changesets BEGIN\n  DELETE FROM changesets_index WHERE docid=old.rowid;\nEND;\n\nCREATE TRIGGER changesets_before_delete BEFORE DELETE ON changesets BEGIN\n  DELETE FROM changesets_index WHERE docid=old.rowid;\nEND;\n\nCREATE TRIGGER changesets_after_update AFTER UPDATE ON changesets BEGIN\n  INSERT INTO changesets_index (docid, metadata_index_text, form_id) VALUES (new.rowid, new.metadata_index_text, new.form_id);\nEND;\n\nCREATE TRIGGER changesets_after_insert AFTER INSERT ON changesets BEGIN\n  INSERT INTO changesets_index (docid, metadata_index_text, form_id) VALUES (new.rowid, new.metadata_index_text, new.form_id);\nEND;\n`;\n"]}