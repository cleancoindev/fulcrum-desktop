{"version":3,"sources":["../../../src/main/commands/setup.js"],"names":["prompt","questions","type","name","message","againQuestion","Setup","run","exit","answers","results","authenticate","email","password","response","body","statusCode","console","log","green","user","JSON","parse","context","contexts","contextAttributes","user_resource_id","id","organization_resource_id","db","account","findOrCreate","_organizationName","_firstName","first_name","_lastName","last_name","_email","_token","api_token","save","red","retry","again","start"],"mappings":";;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,SAASA,MAAT,CAAgBC,SAAhB,EAA2B;AACzB,SAAO,mBAASD,MAAT,CAAgBC,SAAhB,CAAP;AACD;;AAED,MAAMA,YAAY,CAChB;AACEC,QAAM,OADR;AAEEC,QAAM,OAFR;AAGEC,WAAS;AAHX,CADgB,EAKb;AACDF,QAAM,UADL;AAEDE,WAAS,6BAFR;AAGDD,QAAM;AAHL,CALa,CAAlB;;AAYA,MAAME,gBAAgB;AACpBH,QAAM,SADc;AAEpBC,QAAM,OAFc;AAGpBC,WAAS,qCAHW;AAIpB,aAAW;AAJS,CAAtB;;AAOA,MAAME,KAAN,2BAA4B;AACpBC,KAAN,GAAY;AAAA;;AAAA;AACV,UAAIC,OAAO,KAAX;;AAEA,aAAO,CAACA,IAAR,EAAc;AACZ,cAAMC,UAAU,MAAMT,OAAOC,SAAP,CAAtB;;AAEA,cAAMS,UAAU,MAAM,iBAAOC,YAAP,CAAoBF,QAAQG,KAA5B,EAAmCH,QAAQI,QAA3C,CAAtB;AACA,cAAMC,WAAWJ,OAAjB;AACA,cAAMK,OAAOL,QAAQK,IAArB;;AAEA,YAAID,SAASE,UAAT,KAAwB,GAA5B,EAAiC;AAC/BC,kBAAQC,GAAR,CAAY,CAAC,qCAAqCT,QAAQG,KAA9C,EAAqDO,KAAjE;AACA,gBAAMC,OAAOC,KAAKC,KAAL,CAAWP,IAAX,EAAiBK,IAA9B;;AAEA,eAAK,IAAIG,OAAT,IAAoBH,KAAKI,QAAzB,EAAmC;AACjC,kBAAMC,oBAAoB;AACxBC,gCAAkBN,KAAKO,EADC;AAExBC,wCAA0BL,QAAQI;AAFV,aAA1B;;AAKA,kBAAME,KAAK,MAAKA,EAAhB;;AAEA,kBAAMC,UAAU,MAAM,kBAAQC,YAAR,CAAqBF,EAArB,EAAyBJ,iBAAzB,CAAtB;;AAEAK,oBAAQE,iBAAR,GAA4BT,QAAQpB,IAApC;AACA2B,oBAAQG,UAAR,GAAqBb,KAAKc,UAA1B;AACAJ,oBAAQK,SAAR,GAAoBf,KAAKgB,SAAzB;AACAN,oBAAQO,MAAR,GAAiBjB,KAAKR,KAAtB;AACAkB,oBAAQQ,MAAR,GAAiBf,QAAQgB,SAAzB;;AAEA,kBAAMT,QAAQU,IAAR,EAAN;;AAEAvB,oBAAQC,GAAR,CAAY,IAAIC,KAAhB,EAAuBI,QAAQpB,IAA/B;;AAEAK,mBAAO,IAAP;AACD;AACF,SA1BD,MA0BO;AACLS,kBAAQC,GAAR,CAAY,iCAAiCuB,GAA7C;;AAEA,cAAIC,QAAQ,MAAM1C,OAAOK,aAAP,CAAlB;;AAEA,cAAI,CAACqC,MAAMC,KAAX,EAAkB;AAChBnC,mBAAO,IAAP;AACD;AACF;AACF;AA7CS;AA8CX;AA/CyB;;AAkD5B,IAAIF,KAAJ,GAAYsC,KAAZ","file":"setup.js","sourcesContent":["import Command from './command';\nimport 'colors';\nimport inquirer from 'inquirer';\nimport Account from '../models/account';\nimport Client from '../api/client';\n\nfunction prompt(questions) {\n  return inquirer.prompt(questions);\n}\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'email',\n    message: 'Enter your Fulcrum email address'\n  }, {\n    type: 'password',\n    message: 'Enter your Fulcrum password',\n    name: 'password'\n  }\n];\n\nconst againQuestion = {\n  type: 'confirm',\n  name: 'again',\n  message: 'Try again? (just hit enter for YES)',\n  'default': true\n};\n\nclass Setup extends Command {\n  async run() {\n    let exit = false;\n\n    while (!exit) {\n      const answers = await prompt(questions);\n\n      const results = await Client.authenticate(answers.email, answers.password);\n      const response = results;\n      const body = results.body;\n\n      if (response.statusCode === 200) {\n        console.log(('Successfully authenticated with ' + answers.email).green);\n        const user = JSON.parse(body).user;\n\n        for (let context of user.contexts) {\n          const contextAttributes = {\n            user_resource_id: user.id,\n            organization_resource_id: context.id\n          };\n\n          const db = this.db;\n\n          const account = await Account.findOrCreate(db, contextAttributes);\n\n          account._organizationName = context.name;\n          account._firstName = user.first_name;\n          account._lastName = user.last_name;\n          account._email = user.email;\n          account._token = context.api_token;\n\n          await account.save();\n\n          console.log('âœ“'.green, context.name);\n\n          exit = true;\n        }\n      } else {\n        console.log('Username or password incorrect'.red);\n\n        let retry = await prompt(againQuestion);\n\n        if (!retry.again) {\n          exit = true;\n        }\n      }\n    }\n  }\n}\n\nnew Setup().start();\n"]}