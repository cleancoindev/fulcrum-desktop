{"version":3,"sources":["../../../src/main/commands/setup.js"],"names":["prompt","questions","type","name","message","againQuestion","runCommand","exit","answers","results","authenticate","email","password","response","body","statusCode","console","log","green","user","JSON","parse","context","contexts","contextAttributes","user_resource_id","id","organization_resource_id","db","fulcrum","account","findOrCreate","_organizationName","_firstName","first_name","_lastName","last_name","_email","_token","api_token","save","red","retry","again","task","cli","command","desc","builder","handler"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,SAASA,MAAT,CAAgBC,SAAhB,EAA2B;AACzB,SAAO,mBAASD,MAAT,CAAgBC,SAAhB,CAAP;AACD;;AAED,MAAMA,YAAY,CAChB;AACEC,QAAM,OADR;AAEEC,QAAM,OAFR;AAGEC,WAAS;AAHX,CADgB,EAKb;AACDF,QAAM,UADL;AAEDE,WAAS,6BAFR;AAGDD,QAAM;AAHL,CALa,CAAlB;;AAYA,MAAME,gBAAgB;AACpBH,QAAM,SADc;AAEpBC,QAAM,OAFc;AAGpBC,WAAS,qCAHW;AAIpB,aAAW;AAJS,CAAtB;;kBAOe,MAAM;AAAA;AAAA,SAUnBE,UAVmB,qBAUN,aAAY;AACvB,UAAIC,OAAO,KAAX;;AAEA,aAAO,CAACA,IAAR,EAAc;AACZ,cAAMC,UAAU,MAAMR,OAAOC,SAAP,CAAtB;;AAEA,cAAMQ,UAAU,MAAM,iBAAOC,YAAP,CAAoBF,QAAQG,KAA5B,EAAmCH,QAAQI,QAA3C,CAAtB;AACA,cAAMC,WAAWJ,OAAjB;AACA,cAAMK,OAAOL,QAAQK,IAArB;;AAEA,YAAID,SAASE,UAAT,KAAwB,GAA5B,EAAiC;AAC/BC,kBAAQC,GAAR,CAAY,CAAC,qCAAqCT,QAAQG,KAA9C,EAAqDO,KAAjE;AACA,gBAAMC,OAAOC,KAAKC,KAAL,CAAWP,IAAX,EAAiBK,IAA9B;;AAEA,eAAK,IAAIG,OAAT,IAAoBH,KAAKI,QAAzB,EAAmC;AACjC,kBAAMC,oBAAoB;AACxBC,gCAAkBN,KAAKO,EADC;AAExBC,wCAA0BL,QAAQI;AAFV,aAA1B;;AAKA,kBAAME,KAAKC,QAAQD,EAAnB;;AAEA,kBAAME,UAAU,MAAM,kBAAQC,YAAR,CAAqBH,EAArB,EAAyBJ,iBAAzB,CAAtB;;AAEAM,oBAAQE,iBAAR,GAA4BV,QAAQnB,IAApC;AACA2B,oBAAQG,UAAR,GAAqBd,KAAKe,UAA1B;AACAJ,oBAAQK,SAAR,GAAoBhB,KAAKiB,SAAzB;AACAN,oBAAQO,MAAR,GAAiBlB,KAAKR,KAAtB;AACAmB,oBAAQQ,MAAR,GAAiBhB,QAAQiB,SAAzB;;AAEA,kBAAMT,QAAQU,IAAR,EAAN;;AAEAxB,oBAAQC,GAAR,CAAY,IAAIC,KAAhB,EAAuBI,QAAQnB,IAA/B;;AAEAI,mBAAO,IAAP;AACD;AACF,SA1BD,MA0BO;AACLS,kBAAQC,GAAR,CAAY,iCAAiCwB,GAA7C;;AAEA,cAAIC,QAAQ,MAAM1C,OAAOK,aAAP,CAAlB;;AAEA,cAAI,CAACqC,MAAMC,KAAX,EAAkB;AAChBpC,mBAAO,IAAP;AACD;AACF;AACF;AACF,KAxDkB;AAAA;;AACbqC,MAAN,CAAWC,GAAX,EAAgB;AAAA;;AAAA;AACd,aAAOA,IAAIC,OAAJ,CAAY;AACjBA,iBAAS,OADQ;AAEjBC,cAAM,kCAFW;AAGjBC,iBAAS,EAHQ;AAIjBC,iBAAS,MAAK3C;AAJG,OAAZ,CAAP;AADc;AAOf;;AARkB,C","file":"setup.js","sourcesContent":["import 'colors';\nimport inquirer from 'inquirer';\nimport Account from '../models/account';\nimport Client from '../api/client';\n\nfunction prompt(questions) {\n  return inquirer.prompt(questions);\n}\n\nconst questions = [\n  {\n    type: 'input',\n    name: 'email',\n    message: 'Enter your Fulcrum email address'\n  }, {\n    type: 'password',\n    message: 'Enter your Fulcrum password',\n    name: 'password'\n  }\n];\n\nconst againQuestion = {\n  type: 'confirm',\n  name: 'again',\n  message: 'Try again? (just hit enter for YES)',\n  'default': true\n};\n\nexport default class {\n  async task(cli) {\n    return cli.command({\n      command: 'setup',\n      desc: 'setup the local fulcrum database',\n      builder: {},\n      handler: this.runCommand\n    });\n  }\n\n  runCommand = async () => {\n    let exit = false;\n\n    while (!exit) {\n      const answers = await prompt(questions);\n\n      const results = await Client.authenticate(answers.email, answers.password);\n      const response = results;\n      const body = results.body;\n\n      if (response.statusCode === 200) {\n        console.log(('Successfully authenticated with ' + answers.email).green);\n        const user = JSON.parse(body).user;\n\n        for (let context of user.contexts) {\n          const contextAttributes = {\n            user_resource_id: user.id,\n            organization_resource_id: context.id\n          };\n\n          const db = fulcrum.db;\n\n          const account = await Account.findOrCreate(db, contextAttributes);\n\n          account._organizationName = context.name;\n          account._firstName = user.first_name;\n          account._lastName = user.last_name;\n          account._email = user.email;\n          account._token = context.api_token;\n\n          await account.save();\n\n          console.log('âœ“'.green, context.name);\n\n          exit = true;\n        }\n      } else {\n        console.log('Username or password incorrect'.red);\n\n        let retry = await prompt(againQuestion);\n\n        if (!retry.again) {\n          exit = true;\n        }\n      }\n    }\n  }\n}\n"]}