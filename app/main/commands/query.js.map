{"version":3,"sources":["../../../src/main/commands/query.js"],"names":["runCommand","headers","fulcrum","db","each","args","sql","columns","row","index","process","stdout","write","stringify","map","c","name","task","cli","command","desc","builder","type","required","handler"],"mappings":";;;;;;AAAA;;;;;;;;kBAEe,MAAM;AAAA;AAAA,SAgBnBA,UAhBmB,qBAgBN,aAAY;AACvB,UAAIC,UAAU,KAAd;;AAEA,YAAMC,QAAQC,EAAR,CAAWC,IAAX,CAAgBF,QAAQG,IAAR,CAAaC,GAA7B,EAAkC,EAAlC,EAAsC,UAACC,OAAD,EAAUC,GAAV,EAAeC,KAAf,EAAyB;AACnE,YAAI,CAACR,OAAL,EAAc;AACZA,oBAAU,IAAV;AACAS,kBAAQC,MAAR,CAAeC,KAAf,CAAqB,oBAAIC,SAAJ,CAAcN,QAAQO,GAAR,CAAY;AAAA,mBAAKC,EAAEC,IAAP;AAAA,WAAZ,CAAd,CAArB;AACD;;AAED,YAAIR,GAAJ,EAAS;AACPE,kBAAQC,MAAR,CAAeC,KAAf,CAAqB,oBAAIC,SAAJ,CAAcL,GAAd,CAArB;AACD;AACF,OATK,CAAN;AAUD,KA7BkB;AAAA;;AACbS,MAAN,CAAWC,GAAX,EAAgB;AAAA;;AAAA;AACd,aAAOA,IAAIC,OAAJ,CAAY;AACjBA,iBAAS,OADQ;AAEjBC,cAAM,mCAFW;AAGjBC,iBAAS;AACPf,eAAK;AACHgB,kBAAM,QADH;AAEHF,kBAAM,WAFH;AAGHG,sBAAU;AAHP;AADE,SAHQ;AAUjBC,iBAAS,MAAKxB;AAVG,OAAZ,CAAP;AADc;AAaf;;AAdkB,C","file":"query.js","sourcesContent":["import CSV from 'csv-string';\n\nexport default class {\n  async task(cli) {\n    return cli.command({\n      command: 'query',\n      desc: 'run a query in the local database',\n      builder: {\n        sql: {\n          type: 'string',\n          desc: 'sql query',\n          required: true\n        }\n      },\n      handler: this.runCommand\n    });\n  }\n\n  runCommand = async () => {\n    let headers = false;\n\n    await fulcrum.db.each(fulcrum.args.sql, {}, (columns, row, index) => {\n      if (!headers) {\n        headers = true;\n        process.stdout.write(CSV.stringify(columns.map(c => c.name)));\n      }\n\n      if (row) {\n        process.stdout.write(CSV.stringify(row));\n      }\n    });\n  }\n}\n"]}