{"version":3,"sources":["../src/local-database-data-source.js"],"names":["LocalDatabaseDataSource","constructor","account","db","choiceLists","classificationSets","forms","memberships","roles","load","loadObjects","role","projects","map","object","_userID","type","handler","objects","findAll","id","getProject","callback","getChoiceList","getClassificationSet","getForm","getUser","getRole"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEe,MAAMA,uBAAN,CAA8B;AAC3CC,cAAYC,OAAZ,EAAqB;AACnB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,EAAL,GAAUD,QAAQC,EAAlB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,kBAAL,GAA0B,EAA1B;AACA,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,KAAL,GAAa,EAAb;AACD;;AAEKC,MAAN,CAAWN,EAAX,EAAe;AAAA;;AAAA;AACb,YAAKC,WAAL,GAAmB,MAAM,MAAKM,WAAL,CAAiBP,EAAjB,uBAAzB;AACA,YAAKE,kBAAL,GAA0B,MAAM,MAAKK,WAAL,CAAiBP,EAAjB,8BAAhC;AACA,YAAKG,KAAL,GAAa,MAAM,MAAKI,WAAL,CAAiBP,EAAjB,iBAAnB;AACA,YAAKQ,IAAL,GAAY,MAAM,MAAKD,WAAL,CAAiBP,EAAjB,iBAAlB;AACA,YAAKS,QAAL,GAAgB,MAAM,MAAKF,WAAL,CAAiBP,EAAjB,oBAAtB;AACA,YAAKI,WAAL,GAAmB,MAAM,MAAKG,WAAL,CAAiBP,EAAjB,wBAAkC,UAACU,GAAD,EAAMC,MAAN,EAAiB;AAC1ED,YAAIC,OAAOC,OAAX,IAAsBD,MAAtB;AACD,OAFwB,CAAzB;AANa;AASd;;AAEKJ,aAAN,CAAkBP,EAAlB,EAAsBa,IAAtB,EAA4BC,OAA5B,EAAqC;AAAA;AACnC,YAAMC,UAAU,MAAMF,KAAKG,OAAL,CAAahB,EAAb,CAAtB;;AAEA,YAAMU,MAAM,EAAZ;;AAEA,WAAK,MAAMC,MAAX,IAAqBI,OAArB,EAA8B;AAC5B,YAAID,OAAJ,EAAa;AACXA,kBAAQJ,GAAR,EAAaC,MAAb;AACD,SAFD,MAEO;AACLD,cAAIC,OAAOM,EAAX,IAAiBN,MAAjB;AACD;AACF;;AAED,aAAOD,GAAP;AAbmC;AAcpC;;AAEDQ,aAAWD,EAAX,EAAeE,QAAf,EAAyB;AACvB,WAAOA,SAAS,IAAT,EAAe,KAAKV,QAAL,CAAcQ,EAAd,CAAf,CAAP;AACD;;AAEDG,gBAAcH,EAAd,EAAkBE,QAAlB,EAA4B;AAC1B,WAAOA,SAAS,IAAT,EAAe,KAAKlB,WAAL,CAAiBgB,EAAjB,CAAf,CAAP;AACD;;AAEDI,uBAAqBJ,EAArB,EAAyBE,QAAzB,EAAmC;AACjC,WAAOA,SAAS,IAAT,EAAe,KAAKjB,kBAAL,CAAwBe,EAAxB,CAAf,CAAP;AACD;;AAEDK,UAAQL,EAAR,EAAYE,QAAZ,EAAsB;AACpB,WAAOA,SAAS,IAAT,EAAe,KAAKhB,KAAL,CAAWc,EAAX,CAAf,CAAP;AACD;;AAEDM,UAAQN,EAAR,EAAYE,QAAZ,EAAsB;AACpB,WAAOA,SAAS,IAAT,EAAe,KAAKf,WAAL,CAAiBa,EAAjB,CAAf,CAAP;AACD;;AAEDO,UAAQP,EAAR,EAAYE,QAAZ,EAAsB;AACpB,WAAOA,SAAS,IAAT,EAAe,KAAKd,KAAL,CAAWY,EAAX,CAAf,CAAP;AACD;AA5D0C;kBAAxBpB,uB","file":"local-database-data-source.js","sourcesContent":["import Form from './models/form';\nimport ChoiceList from './models/choice-list';\nimport ClassificationSet from './models/classification-set';\nimport Memberships from './models/membership';\nimport Role from './models/role';\nimport Project from './models/project';\n\nexport default class LocalDatabaseDataSource {\n  constructor(account) {\n    this.account = account;\n    this.db = account.db;\n    this.choiceLists = {};\n    this.classificationSets = {};\n    this.forms = {};\n    this.memberships = {};\n    this.roles = {};\n  }\n\n  async load(db) {\n    this.choiceLists = await this.loadObjects(db, ChoiceList);\n    this.classificationSets = await this.loadObjects(db, ClassificationSet);\n    this.forms = await this.loadObjects(db, Form);\n    this.role = await this.loadObjects(db, Role);\n    this.projects = await this.loadObjects(db, Project);\n    this.memberships = await this.loadObjects(db, Memberships, (map, object) => {\n      map[object._userID] = object;\n    });\n  }\n\n  async loadObjects(db, type, handler) {\n    const objects = await type.findAll(db);\n\n    const map = {};\n\n    for (const object of objects) {\n      if (handler) {\n        handler(map, object);\n      } else {\n        map[object.id] = object;\n      }\n    }\n\n    return map;\n  }\n\n  getProject(id, callback) {\n    return callback(null, this.projects[id]);\n  }\n\n  getChoiceList(id, callback) {\n    return callback(null, this.choiceLists[id]);\n  }\n\n  getClassificationSet(id, callback) {\n    return callback(null, this.classificationSets[id]);\n  }\n\n  getForm(id, callback) {\n    return callback(null, this.forms[id]);\n  }\n\n  getUser(id, callback) {\n    return callback(null, this.memberships[id]);\n  }\n\n  getRole(id, callback) {\n    return callback(null, this.roles[id]);\n  }\n}\n\n"]}