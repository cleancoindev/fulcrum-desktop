{"version":3,"sources":["../../../src/sync/tasks/download-classification-sets.js"],"names":["DownloadClassificationSets","run","account","dataSource","sync","checkSyncState","needsUpdate","progress","message","downloading","response","getClassificationSets","objects","JSON","parse","body","classification_sets","processing","count","total","length","index","attributes","object","findOrCreate","db","resource_id","id","account_id","rowID","updateFromAPIAttributes","save","update","finished"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;AAEe,MAAMA,0BAAN,wBAA8C;AACrDC,KAAN,CAAU,EAACC,OAAD,EAAUC,UAAV,EAAV,EAAiC;AAAA;;AAAA;AAC/B,YAAMC,OAAO,MAAM,MAAKC,cAAL,CAAoBH,OAApB,EAA6B,qBAA7B,CAAnB;;AAEA,UAAI,CAACE,KAAKE,WAAV,EAAuB;AACrB;AACD;;AAED,YAAKC,QAAL,CAAc,EAACC,SAAS,MAAKC,WAAL,GAAmB,sBAA7B,EAAd;;AAEA,YAAMC,WAAW,MAAM,iBAAOC,qBAAP,CAA6BT,OAA7B,CAAvB;;AAEA,YAAMU,UAAUC,KAAKC,KAAL,CAAWJ,SAASK,IAApB,EAA0BC,mBAA1C;;AAEA,YAAKT,QAAL,CAAc,EAACC,SAAS,MAAKS,UAAL,GAAkB,sBAA5B,EAAoDC,OAAO,CAA3D,EAA8DC,OAAOP,QAAQQ,MAA7E,EAAd;;AAEA,WAAK,IAAIC,QAAQ,CAAjB,EAAoBA,QAAQT,QAAQQ,MAApC,EAA4C,EAAEC,KAA9C,EAAqD;AACnD,cAAMC,aAAaV,QAAQS,KAAR,CAAnB;;AAEA,cAAME,SAAS,MAAM,4BAAkBC,YAAlB,CAA+BtB,QAAQuB,EAAvC,EAA2C,EAACC,aAAaJ,WAAWK,EAAzB,EAA6BC,YAAY1B,QAAQ2B,KAAjD,EAA3C,CAArB;;AAEAN,eAAOO,uBAAP,CAA+BR,UAA/B;;AAEA,cAAMC,OAAOQ,IAAP,EAAN;;AAEA,cAAKxB,QAAL,CAAc,EAACC,SAAS,MAAKS,UAAL,GAAkB,sBAA5B,EAAoDC,OAAOG,QAAQ,CAAnE,EAAsEF,OAAOP,QAAQQ,MAArF,EAAd;AACD;;AAED,YAAMhB,KAAK4B,MAAL,EAAN;;AAEA,YAAKzB,QAAL,CAAc,EAACC,SAAS,MAAKyB,QAAL,GAAgB,sBAA1B,EAAkDf,OAAON,QAAQQ,MAAjE,EAAyED,OAAOP,QAAQQ,MAAxF,EAAd;AA7B+B;AA8BhC;AA/B0D;kBAAxCpB,0B","file":"download-classification-sets.js","sourcesContent":["import Task from './task';\nimport Client from '../../api/Client';\nimport ClassificationSet from '../../models/classification-set';\n\nexport default class DownloadClassificationSets extends Task {\n  async run({account, dataSource}) {\n    const sync = await this.checkSyncState(account, 'classification_sets');\n\n    if (!sync.needsUpdate) {\n      return;\n    }\n\n    this.progress({message: this.downloading + ' classification sets'});\n\n    const response = await Client.getClassificationSets(account);\n\n    const objects = JSON.parse(response.body).classification_sets;\n\n    this.progress({message: this.processing + ' classification sets', count: 0, total: objects.length});\n\n    for (let index = 0; index < objects.length; ++index) {\n      const attributes = objects[index];\n\n      const object = await ClassificationSet.findOrCreate(account.db, {resource_id: attributes.id, account_id: account.rowID});\n\n      object.updateFromAPIAttributes(attributes);\n\n      await object.save();\n\n      this.progress({message: this.processing + ' classification sets', count: index + 1, total: objects.length});\n    }\n\n    await sync.update();\n\n    this.progress({message: this.finished + ' classification sets', count: objects.length, total: objects.length});\n  }\n}\n"]}